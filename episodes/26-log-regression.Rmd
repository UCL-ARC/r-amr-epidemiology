---
title: "Logistic Regression"
teaching: 60
exercises: 30
source: Rmd
---

::::::::::::::::::::::::::::::::::::::: objectives

- To be able to construct regression models for a binary outcome
- To be able to calculate predicted variables and residuals 
- To be able to present model outcomes using Broom

::::::::::::::::::::::::::::::::::::::::::::::::::

:::::::::::::::::::::::::::::::::::::::: questions

- How can I identify factors for antibiotic resistance?
- How can I check the validity of model?

::::::::::::::::::::::::::::::::::::::::::::::::::

## Content

-   Exploratory Data Analysis
-   Estimate the Models
-   Assumption Testing
-   Report the Logistic Regression Results

## Data

```{r libraries, message=FALSE, warning=FALSE}

# We will need these libraries and this data later.
library(table1)
library(finalfit)
library(aod)
library(ggplot2)
library(tidyverse)
library(lubridate)
library(knitr)
library(odds.n.ends)

amrData <- read.csv("data/dig_health_hub_amr.csv")

```
The data used in this episode was provided by Simon Thelwall from the UKHSA. 
It has been created to represent the sort of data that might be obtained from the Second Generation Surveillance System (SGSS).
The data has 100,000 rows of 12 variables.

## Exploratory Data Analysis

We can preview our data by using 'head':

```{r}

head(amrData)

```
We can also request information about variable names and data types:
```{r}

sapply(amrData, class)

```

We can see that dates are currently stored as the char data type. We also do not know the age of the participant when the sample was taken.

```{r}

# Calculate age (in years) as of their last birthday and add as an additional variable to our data.

amrData <- amrData %>% 
  mutate(
    age_years_sd = (dob %--% spec_date) %/% years(1)
  )

```

We can also convert 'spec_date', the date the specimen was taken from text to a date:
```{r}

# Convert char to date and store as additional variable
amrData <- amrData %>% 
  mutate(
    spec_date_YMD = as.Date(amrData$spec_date)
  )

```
We can use a histogram to explore the age distribution of the participants:

```{r}
# histogram of age
ageHisto <- amrData %>%
  ggplot(aes(x = age_years_sd)) +
  geom_histogram(bins = 10, color = 'white') +
  theme_minimal(base_size = 14, base_family = "sans") +
  labs(x = "Age when specimen taken (years)", y = "Frequency")
ageHisto

```
We can also look at where the specimens were processed:
```{r}

xtabs(~region, data=amrData)

```

In addition, we can use cross-tabulation to identify if the specimen indicated resistance to one or more of Coamoxiclav, Gentamicin and Ciprofloxacin for the participants:

```{r}

xtabs(~coamox+cipro+gentam, data=amrData)

```
We can see from our table that only 227 participants indicated reistance to Coamoxiclav, Gentamicin and Ciprofloxacin.
Coamoxiclav appears to have the highest individual indication of resistance. We will explore indicators to Coamoxiclav first.


